---
output: 
  html_document: 
    fig_height: 3
    fig_width: 7.5
    theme: cerulean
---
White Wine Quality Exploration by Rica Enriquez
========================================================
The white wine quality dataset from Cortez et al. (2009) is explored. The wines
are classified as Vinho Verde and are exclusively produced in the demarcated
region of Vinho Verde in northwestern Portugal. These wines are described to
possess "vibrant freshness, elegance, lightness and aromatic and flavorful
expressions." The paper and data can be found here:

P. Cortez, A. Cerdeira, F. Aloesseida, T. Matos and J. Reis. Modeling wine
preferences by data mining from physicochemical properties. In Decision Support
Systems, Elsevier, 47(4):547-553. ISSN: 0167-9236.

The attributes included in the data set are described below (taken from
"wineQualityInfo.txt"):

1. Fixed acidity: most acids involved with wine or fixed or nonvolatile (does 
not evaporate readily)
2. Volatile acidity: the amount of acetic acid in wine, which at too high of 
levels can lead to an unpleasant, vinegar taste
3. Citric acid: found in small quantities, citric acid can add 'freshness' and
flavor to wines
4. Residual sugar: the amount of sugar remaining after fermentation stops, it's 
rare to find wines with less than 1 gram/liter and wines with greater than 45
grams/liter are considered sweet
5. Chlorides: the amount of salt in the wine
6. Free sulfur dioxide: the free form of SO2 exists in equilibrium between 
molecular SO2 (as a dissolved gas) and bisulfite ion; it prevents microbial 
growth and the oxidation of wine
7. Total sulfur dioxide: amount of free and bound forms of S02; in low concentrations, SO2 is mostly undetectable in wine, but at free SO2 
concentrations over 50 ppm, SO2 becomes evident in the nose and taste of wine
8. Density: the density of water is close to that of water depending on the 
percent alcohol and sugar content
9. pH: describes how acidic or basic a wine is on a scale from 0 (very acidic) 
to 14 (very basic); most wines are between 3-4 on the pH scale
10. Sulphates: a wine additive which can contribute to sulfur dioxide gas (S02)
levels, wich acts as an antimicrobial and antioxidant
11. Alcohol: the percent alcohol content of the wine
12. Quality: score between 0 and 10

Based on the descripitons of Vinho Verde wines and the attributes in the data 
set, the features that are predicted to positively contribute to quality are:

1. Citric acid - adds freshness
2. Total sulfur dixoide - adds taste

The features that are predicted to negatively contribute to quality are:

1. Density - subtracts lightness
2. Volatile acidity - adds an unpleasant, vinegar taste

The following analysis explores the attributes in a systematic manner. The 
features that mainly influence quality are then further investigated.

```{r echo = FALSE, message = FALSE, warning = FALSE, packages}
# Load all of the packages that you end up using
# in your analysis in this code chunk.

# Notice that the parameter "echo" is set to FALSE for this code chunk. This
# prevents the code from displaying in the knitted HTML output. You should set
# echo=FALSE for all code chunks in your file.

library(ggplot2)
library(dplyr)
library(RColorBrewer)
library(GGally)
library(psych)
library(gridExtra)
library(scales)
library(reshape2)
library(memisc)

# Set ggplot themes to minimal
theme_set(theme_minimal(12))
color_palette = "div"
```
#References
1. To create a function to loop over attributes and create individual plots
    + http://stackoverflow.com/questions/11547448/looping-over-ggplot2-with-
    columns
    
2. To create histograms of all attributes
    + http://stackoverflow.com/questions/21511823/histograms-using-ggplot2-
    within-loop  

#The Data Set
```{r echo = FALSE, Load_the_Data}
# Load the Data
wine <- read.csv('wineQualityWhites.csv')

# Make a new factored feature based on quality
wine$score <- factor(wine$quality)

str(wine)
summary(wine)

# Set low and high quantiles
low_q <- 0.05
high_q <- 0.95
```

There are 4898 white wines in the dataset with 11 real features 
("fixed.acidity", "volatile.acidity", "citric.acid", "residual.sugar", 
"chlorides", "free.sulfur.dioxide", "total.sulfur.dioxide", "density", "pH", 
"sulphates", and "alcohol"). The analysis of the dataset is centered on how 
these features are related to the "quality" of a wine. An extra variable, 
"score", is an ordered factor version of the "quality" feature. The "score" 
ranges from 0 - 10 (best).

Most wines are rated in the middle to mid-high (5-6), with a median "quality" of
6. Most features appears to have large outliers. "density" and "pH" might be 
exceptions. These characteristics might be easier to measure accurately than the
other features. The median "residual.sugar" content is 5.200 $g/dm^3$ and the 
median "alcohol" content is 10.51 vol.%.

##Histogram of Wine Qualities
```{r echo = FALSE, warning = FALSE, error = FALSE, message = FALSE, Histogram}
ggplot(aes(quality), data=subset(wine, !is.na(quality))) + 
  geom_histogram(binwidth = 1) + scale_x_discrete(breaks = 0:10)
```

The quality of white wines appear to follow somewhat of a normal distribution. 
The scale is from 0 - 10, but the lowest score given was a 3 (20 wines) and the
highest was a 9 (5 wines). Are there common profiles for the worst and best 
wines?

##Histograms
###Base Histograms of Wine Properties
A set of base histograms are created for all attributes.
```{r echo = FALSE, warning = FALSE, error = FALSE, message = FALSE, include = TRUE, fig.width = 7.5, fig.height= 15, Histogram2}

wine_hist <- subset(wine, select = -c(X, quality, score))
ggplot(melt(wine_hist), aes(x = value)) + 
  facet_wrap(~ variable, scales = "free", ncol = 2) + 
  geom_histogram()

rm(wine_hist)
```

The plots above show the distribution of all of the features. The base
histograms show that "fixed.acidity", "citric.acid", "total.sulfur.dioxide",
"density", "pH", and "sulphates" are normally distributed while
"volatile.acidity", "residual.sugar", "chlorides", "free.sulfur.dioxide", and
"alcohol" have skewed distributions. However, binwidths and axes need adjustment
in order to find any unexpected distributions. Histograms of features that
provide significantly more information than the base histograms are presented
below.

###Altered Histogram of Citric Acid
```{r echo = FALSE, warning = FALSE, error = FALSE, message = FALSE, Histogram3}

ggplot(subset(wine, !is.na(quality) & !is.na(citric.acid)), 
       aes(x = citric.acid, fill = score)) + 
  geom_histogram(binwidth = .02) +
  xlim(c(0, .8)) + 
  scale_fill_brewer(type = color_palette)
```

There appears to be a ~0.3 $g/dm^3$ peak and a ~0.5 $g/dm^3$ spike. It would be
interesting to know which wines have a citric acid content ~0.5 $g/dm^3$.

###Altered Histogram of Resdiual Sugar
```{r echo = FALSE, warning = FALSE, error = FALSE, message = FALSE, Histogram4}

ggplot(subset(wine, !is.na(quality) & !is.na(residual.sugar)), 
       aes(x = residual.sugar, fill = score)) + 
  geom_histogram() + 
  scale_x_log10() + 
  scale_fill_brewer(type = color_palette)
```

There appears to be a bimodal distribution for residual sugar content. There are
probably wines for people who prefer drier wines and for othes who prefer
sweeter wines. It would be interesting to know the properties of these two
subsets.

###Altered Histogram of Chlorides
```{r echo = FALSE, warning = FALSE, error = FALSE, message = FALSE, Histogram5}

ggplot(subset(wine, !is.na(quality) & !is.na(chlorides)), 
       aes(x = chlorides, fill = score)) + 
  geom_histogram(binwidth = 0.05) +
  scale_x_log10() + 
  scale_fill_brewer(type = color_palette)
```

There is a long tail of higher chloride concentrations for the lower quality
wines.

###Altered Histogram of Free Sulfur Dioxide
```{r echo = FALSE, warning = FALSE, error = FALSE, message = FALSE, Histogram6}

ggplot(subset(wine, !is.na(quality) & !is.na(free.sulfur.dioxide)), 
       aes(x = free.sulfur.dioxide, fill = score)) + 
  geom_histogram(binwidth = 5) + 
  xlim(c(0, 100)) + 
  scale_fill_brewer(type = color_palette)
```

The lower quality wines tend to have lower free sulfur dioxide concentrations.

###Altered Histogram of Alcohol
```{r echo = FALSE, warning = FALSE, error = FALSE, message = FALSE, Histogram7}

ggplot(subset(wine, !is.na(quality) & !is.na(alcohol)), 
       aes(x = alcohol, fill = score)) + 
  geom_histogram(binwidth = 0.5) + 
  scale_fill_brewer(type = color_palette)
```

The higher quality wines tend to have more alcohol content.

## Box Plots
###Box Plots of Wine Properties, Separated by Wine Quality
A set of box plots are created for all features. The data is limited to the
middle 90%. The mean for each category is plotted as an "x".
```{r echo = FALSE, warning = FALSE, error = FALSE, message = FALSE, results = "hide", BoxPlot}

# Loop through all the features to make boxplots, separated by "score". Only the middle 90% of data is plotted and the mean of each feature for each "score" is plotted as an "x".
lapply((names(wine)[2:12]), 
       function(i) ggplot(subset(wine, !is.na(quality) & !is.na(i)), 
                          aes_string(x = "score", y = i, fill = "score")) +
         geom_boxplot() + 
         ylim(quantile(wine[[i]], low_q, names = FALSE), 
              quantile(wine[[i]], high_q, names = FALSE)) + 
         scale_fill_brewer(type = color_palette) + 
         stat_summary(fun.y = mean, geom = "point", shape = 4))
```

The features that appear to vary with wine quality are "volatile.acidity",
"citric.acid", "residual.sugar", "chlorides", "free.sulfur.dioxide",
"total.sulfur.dioxide", "density", "pH", and "alcohol". It seems that the
variation within a feature is more obvious through these set of box plots than
the previous set of histograms. The top features appear to be "density" and
"alcohol".

##Correlations and Scatterplots
Scatterplots and correlation calculations of the characteristics of wine that
might be more closely associated to quality should help ascertain which features
might be important to quality. Additionally, how the individual features
correlate with each other will be investigated.

###Correlation Coefficients and a Pair Plot for Selected Features
```{r echo = FALSE, warning = FALSE, error = FALSE, message = FALSE, include = TRUE, fig.width = 7.5, fig.height= 7.5, Scatterplot}

wine <- subset(wine, select = -c(X, fixed.acidity, sulphates))
cor(subset(wine, select = -score))
# Create a matrix of plots of the above features
pairs.panels(subset(wine, select = -score), ellipses = FALSE)
```

The "alcohol" feature has a strong correlation with wine quality. The "density"
feature has a moderately strong correlation with the quality of wine.
"residual.sugar" presents a bimodal distribution, and would not necessarily have
a strong linear correlation with wine quality. It will be explored further since
"density", and "alcohol" have strong correlations with "residual.sugar". In
fact, the correlation between "density" and "residual.sugar" is the strongest in
this set. Similarly, "total.sulfur.dioxide" has a strong correlation with
"density". "alcohol" also has a strong correlation with "chlorides" and
"total.sulfur.dioxide". The relation of these variables with each other and
quality will be analyzed more closely.

### Middle 90% of Alcohol vs. Density
```{r echo = FALSE, warning = FALSE, error = FALSE, message = FALSE, include = TRUE, Scatterplot_1}

ggplot(wine, aes(x = alcohol, y = density, color = score)) + 
  geom_point() + 
  xlim(quantile(wine$alcohol, low_q), quantile(wine$alcohol, high_q)) +
  ylim(quantile(wine$density, low_q), quantile(wine$density, high_q)) +
  geom_smooth(method = "loess", color = "black") + 
  scale_color_brewer(type = color_palette)

# Color by "residual.sugar"
mid<-median(subset(wine$residual.sugar, wine$residual.sugar < 25))
ggplot(wine, aes(x = alcohol, y = density, color = residual.sugar)) + 
  geom_point() + 
  xlim(quantile(wine$alcohol, low_q), quantile(wine$alcohol, high_q)) +
  ylim(quantile(wine$density, low_q), quantile(wine$density, high_q)) +
  geom_smooth(method = "loess", color = "black") + 
  scale_color_gradient2(limits = c(0, 25), midpoint = mid, low = "magenta", 
                        mid = "white", high = "green" )
```

There is a strong negative linear relationship between "density"" and "alcohol".
As "alcohol" increases, "density"" decreases. The higher quality wines tend
cluster in the lower right region, which is the higher alcohol content, lower
"density" wines.  It would be interesting to see if this ratio is a better
feature. Additionally, there appears to be a clear separation between wines with
higher "residual.sugar" and lower "residual.sugar". The higher "residual.sugar"
wines tend to have a higher density:alcohol ratio.

### Middle 90% of Alcohol vs. Residual Sugar
```{r echo = FALSE, warning = FALSE, error = FALSE, message = FALSE, include = TRUE, Scatterplot_2}

ggplot(wine, aes(x = alcohol, y = residual.sugar, color = score)) + 
  geom_point() + 
  xlim(quantile(wine$alcohol, low_q), quantile(wine$alcohol, high_q)) +
  ylim(quantile(wine$residual.sugar, low_q), 
       quantile(wine$residual.sugar, high_q)) + 
  geom_smooth(method = "loess", color = "black") + 
  scale_color_brewer(type = color_palette)
```

The "residual.sugar" decreases with increasing "alcohol". However, there isn't a
strong linear relationship between "residual.sugar" and "alcohol" for the whole
range. An exponential decay in "residual.sugar" appears to exist with increasing
"alcohol". The higher "quality" wines tend to have a higher "alcohol" and lower
"residual.sugar" content.

### Middle 90% of Alcohol vs. Total Sulfur Dioxide
```{r echo = FALSE, warning = FALSE, error = FALSE, message = FALSE, include = TRUE, Scatterplot3}

ggplot(wine, aes(x = alcohol, y = total.sulfur.dioxide, color = score)) +
  geom_point() + 
  xlim(quantile(wine$alcohol, low_q), quantile(wine$alcohol, high_q)) +
  ylim(quantile(wine$total.sulfur.dioxide, low_q), 
       quantile(wine$total.sulfur.dioxide, high_q)) + 
  geom_smooth(method = "loess", color = "black") + 
  scale_color_brewer(type = color_palette)
```

There is a negative linear relationship between "total.sulfur.dioxide" and
"alcohol". As "alcohol" increases, "total.sulfur.dioxide" decreases.

### Middle 90% of Alcohol vs. Chlorides
```{r echo = FALSE, warning = FALSE, error = FALSE, message = FALSE, include = TRUE, Scatterplot4}

ggplot(wine, aes(x = alcohol, y = chlorides, color = score)) + 
  geom_point() + 
  xlim(quantile(wine$alcohol, low_q), quantile(wine$alcohol, high_q)) +
  ylim(quantile(wine$chlorides, low_q), quantile(wine$chlorides, high_q)) +
  geom_smooth(method = "loess", color = "black") + 
  scale_color_brewer(type = color_palette)
```

There is a negative linear relationship between "chlorides" and "alcohol". As
"alcohol" increases, "chlorides" decreases.

### Middle 90% of Density vs. Residual Sugar
```{r echo = FALSE, warning = FALSE, error = FALSE, message = FALSE, include = TRUE, Scatterplot5}

ggplot(wine, aes(x = density, y = residual.sugar, color = score)) + 
  geom_point() + 
  xlim(quantile(wine$density, low_q), quantile(wine$density, high_q)) +
  ylim(quantile(wine$residual.sugar, low_q), 
       quantile(wine$residual.sugar, high_q)) + 
  geom_smooth(method = "loess", color = "black") + 
  scale_color_brewer(type = color_palette)
```

The "residual.sugar" increases with increasing "density". The relationship
between "residual.sugar" and "density" appears to be more of an exponential
growth. The higher "quality" wines tend to have a higher
"residual.sugar":"density" ratio.

### Middle 90% of Density vs. Total Sulfur Dioxide
```{r echo = FALSE, warning = FALSE, error = FALSE, message = FALSE, include = TRUE, Scatterplot6}

ggplot(wine, aes(x = density, y = total.sulfur.dioxide, color = score)) +
  geom_point() + 
  xlim(quantile(wine$density, low_q), quantile(wine$density, high_q)) +
  ylim(quantile(wine$total.sulfur.dioxide, low_q),
       quantile(wine$total.sulfur.dioxide, high_q)) + 
  geom_smooth(method = "loess", color = "black") + 
  scale_color_brewer(type = color_palette)
```

There is a linear relationship between "total.sulfur.dioxide" and "density". As
"total.sulur.dioxide" increases, "density" increases. This plot also shows that
higher "quality" wines tend to have lower "density" values.

### Correlations of Density:Residual Sugar and Density:Alcohol vs. Quality
The previous scatterplots showed that the  Density:Residual Sugar and
Density:Alcohol may be important transformed features. Here, the correlation of
the ratios with quality is examined.
```{r echo = FALSE, warning = FALSE, error = FALSE, message = FALSE, include = TRUE, results= "hide", fig.width = 7.5, fig.height= 15, Ratios}

wine$density_sugar <- wine$density/wine$residual.sugar
wine$density_alcohol <- wine$density/wine$alcohol
cor.test(x = wine$density_sugar, y = wine$quality, method = "pearson")
cor.test(x = wine$density_alcohol, y = wine$quality, method = "pearson")
wine <- subset(wine, select = -c(density_sugar, density_alcohol))
```

The correlation between "density":"residual.sugar" and "quality" is 0.008996164
and is low, showing that it is not an important feature for quality. The
correlation between "density":"alcohol"" and "quality" is -0.4244115. It is a
strong negative correlation, but the positive correlation between "quality" and
"alcohol" is stronger.

### Group by Quality Plots
Now that the secondary attributes are investigated, the median attributes of
"alcohol" and "density" by quality are investigated.
```{r echo = FALSE, warning = FALSE, error = FALSE, message = FALSE, include = TRUE, results= "hide", fig.width = 7.5, fig.height = 6, QualityGroup}

wine_by_quality <- subset(wine, !is.na(quality)) %>%
  group_by(quality) %>%
  summarise(density_median = median(density),
            alcohol_median = median(alcohol),
            n=n()) %>%
            arrange(quality)

plot_1 <- ggplot(wine_by_quality, aes(x = alcohol_median, y = quality)) +
  geom_point() + 
  geom_smooth(method = "lm", color = "black")

plot_2 <- ggplot(wine_by_quality, aes(x = density_median, y = quality)) +
  geom_point() + 
  geom_smooth(method = "lm", color = "black")

grid.arrange(plot_1, plot_2, ncol = 1)
cor.test(x = wine_by_quality$alcohol_median, y = wine_by_quality$quality, 
         method = "pearson")
cor.test(x = wine_by_quality$density_median, y = wine_by_quality$quality, 
         method = "pearson")

rm(wine_by_quality)
```

Medians of "alcohol" and "density" values may have linear relationships with
"quality". The "alcohol" medians provide a correlation of 0.8476837 with
"quality". The "density" medians provide a correlation of -0.8885051 with
"quality".

### Secondary Citric Acid Peak
```{r echo = FALSE, warning = FALSE, error = FALSE, message = FALSE, include = TRUE, results = "hide", fig.width = 7.5, fig.height = 6, CitricPeak}

wine_citric <- subset(wine, citric.acid == 0.49)
dim(wine_citric)[1]
colMeans(subset(wine_citric, select = -c(quality, score)))

plot_1 <- ggplot(wine_citric, aes(score)) + geom_histogram(binwidth = 1)
plot_2 <- ggplot(wine_citric, aes(residual.sugar)) + 
  geom_histogram(binwidth = 4)
plot_3 <- ggplot(wine_citric, aes(alcohol)) + geom_histogram(binwidth = 1)
plot_4 <- ggplot(wine_citric, aes(density)) + geom_histogram(binwidth = 0.002)
 
grid.arrange(plot_1, plot_2, plot_3, plot_4, ncol = 2)

rm(wine_citric)
```

The secondary peak is at 0.49 $g/dm^3$, which is much greater than the average
concentration found at every quality level.The citric acid supposedly adds
'freshness' and flavor to wines. There are 215 wines with this acidity, and the
majority of them are mediocre wines with average sugar content, average alcohol
content, and average density (compared to global averages).


### Residual Sugar Subsets
For this part of the analysis, the wines are separated into two sets. A set of
wines that has 4 $g/dm^3$ residual sugar content or less, and a set of wines
that has more than 4 $g/dm^3$ residual sugar.

```{r echo = FALSE, warning = FALSE, error = FALSE, message = FALSE, include = TRUE, results = "hide", fig.width = 7.5, fig.height = 3, SugarSubsets}

wine_sugar_4under <- subset(wine, residual.sugar <= 4)
wine_sugar_4over <- subset(wine, residual.sugar > 4)

plot_1 <- ggplot(subset(wine_sugar_4under, !is.na(quality) & 
                          !is.na(residual.sugar)), aes(x = residual.sugar)) + 
  geom_histogram(binwidth = 0.2) + 
  scale_x_continuous(limits=c(0, 4))

plot_2 <- ggplot(subset(wine_sugar_4over, !is.na(quality) & 
                          !is.na(residual.sugar)), aes(x = residual.sugar)) +
  geom_histogram(binwidth = 1) + 
  scale_x_continuous(limits=c(0, 25))

grid.arrange(plot_1, plot_2, ncol = 2) 
```

#### Residual Sugar Subset - 4 $g/dm^3$ and under
```{r echo = FALSE, warning = FALSE, error = FALSE, message = FALSE, include = TRUE, fig.width = 7.5, fig.height = 7.5, SugarSubset4under}

colMeans(subset(wine_sugar_4under, select = -c(quality, score)))
pairs.panels(subset(wine_sugar_4under, select = -score), ellipses = FALSE)

rm(wine_sugar_4under)
```

The low "residual.sugar" subset has slightly higher correlation magnitudes
between "quality" and most other attributes, on average. However, the magnitude
of correlations of all other attributes are generally lower in this subset than
the ones in the full data set. The "residual.sguar" correlations are
surprisingly much much lower in this subset. The average attributes of this
subset are also similar to the average attributes of the full data set. The
exceptions include: lower "residual.sugar", "free.sulfur.dioxide", and
"total.sulfur.dioxide" values.

#### Residual Sugar Subset - over 4 $g/dm^3$
```{r echo = FALSE, warning = FALSE, error = FALSE, message = FALSE, include = TRUE, fig.width = 7.5, fig.height = 7.5, SugarSubset4over}

colMeans(subset(wine_sugar_4over, select = -c(quality, score)))
pairs.panels(subset(wine_sugar_4over, select = -score), ellipses = FALSE)
#dim(wine_sugar_4over)[1]/dim(wine)[1]*100
rm(wine_sugar_4over)
```

This subset does not appear to be significantly different from the full data set
(other than "residual.sugar") even though it contains only about 57% of the
wines,. This subset does have slighlty higher means in "chlorides" and
"free.sulfur.dioxide".

### Worst Wine Analysis
```{r echo = FALSE, warning = FALSE, error = FALSE, message = FALSE, include = TRUE, fig.width = 7.5, fig.height = 7.5, WorstWine}

wine_worst <- subset(wine, quality <= 4)
colMeans(subset(wine_worst, select = -c(quality, score)))
pairs.panels(subset(wine_worst, select = -score), ellipses = FALSE)
rm(wine_worst)
```

The worst wines have a higher "volatile.acidity" and "chlorides" andlower
"citric.acid", "residual.sugar", and "free.sulfur.dioxide" than the average of
all wines. The "quality" of the worst wines are more associated with
"free.sulfur.dioxide" and "total.sulfur.dioxide". "alcohol" and "density" hardly
correlate with "quality". Perhaps this is because there are only two levels for
"quality".

### Best Wine Analysis
```{r echo = FALSE, warning = FALSE, error = FALSE, message = FALSE, include = TRUE, fig.width = 7.5, fig.height = 7.5, BestWine}

wine_best <- subset(wine, quality >= 8)
colMeans(subset(wine_best, select = -c(quality, score)))
pairs.panels(subset(wine_best, select = -score), ellipses = FALSE)
rm(wine_best)
```

The best wines have lower "chlorides" and more "alcohol". Similarly, alcohol"
and "density" hardly correlate with "quality". This is probably because there
are only two levels for "quality" in this subset as wll.

### Note on Not Building a Linear Model
A linear model does not seem appropriate for predicting the quality of a wine
since "qualtiy" is a categorical variable. In  fact, Cortez et al. (2009) use
Support Vector Machine (SVM) to predict the quality of wine. The ultimate
outcome of this analysis is to highlight the main features of Vinho Verde white
wine quality.

# Final Plots and Summary

###Summary
The features that contribute to Vinho Verde white wine "quality" the most are
"alcohol" and "density". "residual.sugar", citric.acid", "chlorides", and
"free.sulfur.dioxide" may also be the next important features. These features
are different from the predicted features ("citric.acid",
"total.sulfur.dixoide", and "volatile.acidity") that were based on the Vinho
Verde description and features descriptions. The only feature that was predicted
to be importatnt was "density". Correlations between the features were examined
and interesting subsets were further analyzed.

### Plot One
```{r echo = FALSE, warning = FALSE, error = FALSE, message = FALSE, include = TRUE, fig.width = 7.5, fig.height = 6, Plot_One}

plot_1 <- ggplot(wine, aes(y = alcohol, x = score, color = score)) +
  geom_point(position=position_jitter(h = 0)) + 
  ylim(quantile(wine$alcohol, low_q), quantile(wine$alcohol, high_q)) +
  scale_color_brewer(type = color_palette, name = "Quality") +
  ylab("Alcohol (% by volume)") +
  xlab("Quality (0 - 10)") + 
  ggtitle("Scatterplots of Wine Alcohol Content, Separated by Quality")

plot_2 <- ggplot(wine, aes(y = alcohol, x = score, fill = score)) + 
  geom_boxplot() +  
  ylim(quantile(wine$alcohol, low_q, names = FALSE),
       quantile(wine$alcohol, high_q, names = FALSE)) + 
  scale_fill_brewer(type = color_palette, name = "Quality") + 
  stat_summary(fun.y = mean, geom = "point", shape = 4) + 
  ylab("Alcohol (% by volume)") +
  xlab("Quality (0 - 10)") + 
  ggtitle("Box Plots of Wine Alcohol Content, Separated by Quality")

grid.arrange(plot_1, plot_2, ncol = 1)
```

Alcohol content appears to influence wine "quality" positively, if the wine is
at least mediocre (quality level of 5 and greater). Generally, as alcohol
content increases, wine quality also increases. The top plot shows the range of
the alcohol content for each "quality" level and the bottom plot shows how both
the median and means of alcohol content increase with "quality".

### Plot Two
```{r echo = FALSE, warning = FALSE, error = FALSE, message = FALSE, include = TRUE, fig.width = 7.5, fig.height = 7.5, Plot_Two}

mid<-median(subset(wine$residual.sugar, wine$residual.sugar < 25))
plot_1 <- ggplot(wine, aes(x = alcohol, y = density, color = residual.sugar)) +
  geom_point() + 
  xlim(quantile(wine$alcohol, low_q), quantile(wine$alcohol, high_q)) +
  ylim(quantile(wine$density, low_q), quantile(wine$density, high_q)) +
  geom_smooth(method = "loess", color = "black") + 
  scale_color_gradient2(limits=c(0, 25), midpoint = mid, low = "magenta", 
                        mid = "white", high = "green", 
                        name = expression(paste("Residual Sugar (g/", 
                                                dm^{3}, ")"))) +
  xlab("Alcohol (% by volume)") +
  ylab(expression(paste("Density (g/", cm^{3}, ")"))) +
  ggtitle("Scatterplots of Wine Alcohol Content vs. Density, 
        Colored by Residual Sugar Content")


plot_2 <- ggplot(wine, aes(x = density, y = residual.sugar, color = score)) +
  geom_point() + 
  xlim(quantile(wine$density, low_q), quantile(wine$density, high_q)) +
  ylim(quantile(wine$residual.sugar, low_q), 
       quantile(wine$residual.sugar, high_q)) + 
  geom_smooth(method = "loess", color = "black") + 
  scale_color_brewer(type = color_palette, name = "Quality") + 
  xlab(expression(paste("Residual Sugar (g/", dm^{3}, ")"))) +
  ylab(expression(paste("Density (g/", cm^{3}, ")"))) +
  ggtitle("Scatterplots of Residual Sugar Content vs. Density, 
        Colored by Wine Quality")

grid.arrange(plot_1, plot_2, ncol = 1)
```

"density" and "alcohol" have the largest correlation with "quality", but there 
is an underlying relationship between "density", "alcohol", and 
"residual.sugar". The top plot shows how "density"" decreases with increasing
"alcohol"" content. Additionally, there is a clear separtion between higher and
lower "residual.sugar" content. While "residual.sugar"and
"density":"residual.sugar" did not highly correlate with "quality", this plot
shows that there is a separation in "quality". Since these three features are
highly correlated, perhaps not all three features should be included in
predicting wine "quality".

### Plot Three
```{r echo = FALSE, warning = FALSE, error = FALSE, message = FALSE, include = TRUE, Plot_Three}

ggplot(subset(wine, !is.na(quality) & !is.na(residual.sugar)), 
       aes(x = residual.sugar, fill = score)) + 
  geom_histogram() + 
  scale_x_log10() + 
  scale_fill_brewer(type = color_palette, name = "Quality") + 
  xlab(expression(paste("Residual Sugar (g/", dm^{3}, ")"))) +
  ylab("Number of Wines") + 
  ggtitle("Histogram of Residual Sugar Content, Colored by Wine Quality")
```

This last plot shows that there are two subsets of sugar content wine for people
who prefer sweeter wines or drier wines. It was analyzed that other than sugar
content, these subsets were not significantly different from the average of all
wnes.

# Reflection
The most difficult parf of the analysis was recognizing that wine "quality"
could not be treated as a continuous variable, like diamond price. At first, I
was trying to find which feature transformations would lead to the highest
correlation with "quality". Since there are only seven "quality" categories,
correlations do not tell the whole story. After this realization, the analysis
became easier and I was able to ask interesting questions. I think finding the
interesting subsets (citric acid peak, and residual sugar subsets) will be
useful for future analysis and applying a machine learning algoritm.